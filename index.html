<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hill Climb Canvas</title>
    <link rel="stylesheet" href="style.css" />
    <!-- Matter.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/matter-js@0.20.0/build/matter.min.js"></script>
    <!-- Platform SDKs - Loaded conditionally based on platform -->
    <!-- Poki SDK - Will be loaded automatically when embedded on Poki -->
    <script>
      // Auto-detect and load platform SDKs
      (function() {
        try {
          let hostname = window.location.hostname;
          try {
            if (window.parent !== window) {
              hostname = window.parent.location.hostname;
            }
          } catch (e) {
            // Cross-origin, use current hostname
          }
          
          // Load Poki SDK if on Poki or if Poki SDK is expected
          if (hostname.includes('poki.com') || window.location.search.includes('poki=true')) {
            const pokiScript = document.createElement('script');
            pokiScript.src = 'https://game-cdn.poki.com/scripts/v2/poki-sdk.js';
            pokiScript.async = true;
            pokiScript.onerror = () => console.warn('Failed to load Poki SDK');
            document.head.appendChild(pokiScript);
          }
          
          // Load CrazyGames SDK if on CrazyGames or if CrazyGames SDK is expected
          if (hostname.includes('crazygames.com') || window.location.search.includes('crazygames=true')) {
            const cgScript = document.createElement('script');
            cgScript.src = 'https://sdk.crazygames.com/crazygames-sdk-v2.js';
            cgScript.async = true;
            cgScript.onerror = () => console.warn('Failed to load CrazyGames SDK');
            document.head.appendChild(cgScript);
          }
        } catch (error) {
          console.warn('Platform detection error:', error);
        }
      })();
    </script>
  </head>
  <body>
    <div id="game-root">
      <canvas id="game-canvas"></canvas>

      <!-- Overlay UI Screens -->
      <div id="screen-main-menu" class="screen active">
        <div class="panel">
          <h1 class="title">Hill Climb Canvas</h1>
          <button id="btn-play">Play</button>
          <button id="btn-garage">Garage</button>
          <button id="btn-levels">Levels</button>
          <button id="btn-settings">Settings</button>
          <button id="btn-leaderboard">Leaderboard</button>
        </div>
      </div>

      <div id="screen-level-select" class="screen">
        <div class="panel">
          <h2>Select Level</h2>
          <div id="level-grid"></div>
          <button class="btn-back" data-target="screen-main-menu">Back</button>
        </div>
      </div>

      <div id="screen-garage" class="screen">
        <div class="panel">
          <h2>Garage</h2>
          <div id="vehicle-carousel"></div>
          <div id="vehicle-stats"></div>
          <div id="vehicle-actions">
            <button id="btn-unlock-vehicle">Unlock</button>
            <button id="btn-unlock-ad">Watch Ad to Unlock</button>
            <button id="btn-select-vehicle">Select</button>
          </div>
          <div id="vehicle-actions-coins" style="margin-top:8px">
            <button id="btn-watch-ad-coins" style="background:linear-gradient(135deg,#667eea,#764ba2)">Watch Ad for 50 Coins</button>
          </div>
          <button class="btn-back" data-target="screen-main-menu">Back</button>
        </div>
      </div>

      <div id="screen-pause" class="screen">
        <div class="panel">
          <h2>Paused</h2>
          <button id="btn-resume">Resume</button>
          <button id="btn-restart">Restart</button>
          <button id="btn-quit">Quit</button>
        </div>
      </div>

      <div id="screen-ad" class="screen">
        <div class="panel">
          <h2>Ad Break</h2>
          <p style="font-size:0.8rem;opacity:0.8;margin-bottom:8px">
            Thanks for playing! Your support keeps this game free.
          </p>
          <div id="ad-slot-interstitial" style="width:100%;min-height:120px;margin:8px 0;background:rgba(0,0,0,0.35);border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:0.8rem;opacity:0.7;">
            Interstitial ad goes here
          </div>
          <button id="btn-ad-continue">Continue</button>
        </div>
      </div>

      <div id="screen-gameover" class="screen">
        <div class="panel">
          <h2 id="gameover-title">Game Over</h2>
          <p id="gameover-summary"></p>
          <p id="gameover-stars"></p>
          <button id="btn-gameover-restart">Restart</button>
          <button id="btn-gameover-ad-coins" style="background:linear-gradient(135deg,#667eea,#764ba2)">Watch Ad for 50 Coins</button>
          <button id="btn-gameover-levels">Level Select</button>
          <button id="btn-gameover-main">Main Menu</button>
        </div>
      </div>

      <!-- HUD -->
      <div id="hud">
        <div id="hud-top">
          <div id="hud-coins">
            <div class="icon-coin"></div>
            <span id="hud-coin-count">0</span>
          </div>
          <div id="hud-distance">
            <span id="hud-distance-current">0m</span>
            <span id="hud-distance-best">Best: 0m</span>
          </div>
          <button id="btn-pause" class="hud-button">II</button>
        </div>
        <div id="hud-bottom">
          <button id="btn-brake" class="pedal pedal-left">Brake</button>
          <div id="hud-gauges">
            <canvas id="gauge-rpm" width="90" height="90"></canvas>
            <canvas id="gauge-fuel" width="90" height="90"></canvas>
            <canvas id="gauge-boost" width="90" height="90"></canvas>
          </div>
          <button id="btn-gas" class="pedal pedal-right">Gas</button>
        </div>
      </div>
    </div>

    <script type="module" src="js/main.js"></script>
  </body>
  </html>

